"use strict";(()=>{var v=Object.defineProperty;var x=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var b=(e,n,t)=>n in e?v(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,h=(e,n)=>{for(var t in n||(n={}))I.call(n,t)&&b(e,t,n[t]);if(x)for(var t of x(n))k.call(n,t)&&b(e,t,n[t]);return e};console.log("UI JS loaded: version test");var w="RESET_TO_INITIAL",p=[],l=null,g={},r={component:"",primaryAction:"",conditionalRules:[]};document.addEventListener("DOMContentLoaded",()=>{$(),parent.postMessage({pluginMessage:{type:"init"}},"*")});function $(){var e,n,t,o,i;(e=document.getElementById("component-list"))==null||e.addEventListener("click",a=>{let c=a.target.closest(".component-item");c&&z(c.dataset.componentId)}),(n=document.getElementById("primary-action"))==null||n.addEventListener("change",a=>{r.primaryAction=a.target.value,s()}),(t=document.getElementById("add-rule"))==null||t.addEventListener("click",B),(o=document.getElementById("create-interaction"))==null||o.addEventListener("click",L),(i=document.getElementById("cancel"))==null||i.addEventListener("click",()=>{parent.postMessage({pluginMessage:{type:"cancel"}},"*")})}function B(){console.log("addConditionalRule called");let n={id:Date.now(),condition:"",action:""};r.conditionalRules.push(n),d(),s()}function L(){if(console.log("createInteraction called"),!r.component||!r.primaryAction){m("Please select a component and primary action","error");return}let e={id:`${r.component}_${Date.now()}`,component:r.component,primaryAction:r.primaryAction,conditionalRules:r.conditionalRules};parent.postMessage({pluginMessage:{type:"create-interaction",data:e}},"*")}function s(){let e=document.getElementById("rule-preview-text");if(!e)return;if(!r.component||!r.primaryAction){e.textContent="Select a component type and define the primary click action";return}let n=(l==null?void 0:l.name)||"Unknown Component",t=r.primaryAction,o=r.conditionalRules.length,i=`When ${n} is clicked, change to "${t}"`;o>0&&(i+=`
Apply ${o} conditional rule${o!==1?"s":""} to other instances`),e.textContent=i}function d(){let e=document.getElementById("conditional-rules");if(e){if(e.innerHTML="",r.conditionalRules.length===0){e.innerHTML='<div class="empty-rules">No conditional rules added yet</div>';return}r.conditionalRules.forEach((n,t)=>{var c;let o=document.createElement("div");o.className="conditional-rule-item",o.innerHTML=`
      <div class="rule-if-label">If:</div>
      <select class="rule-condition" data-rule-index="${t}" data-rule-part="condition">
        <option value="">Select condition...</option>
        ${S()}
      </select>
      <div class="rule-then-label">Then:</div>
      <select class="rule-action" data-rule-index="${t}" data-rule-part="action">
        <option value="">Select action...</option>
        ${R()}
      </select>
      <button class="remove-rule" data-rule-index="${t}">\xD7</button>
    `;let i=o.querySelector('[data-rule-part="condition"]'),a=o.querySelector('[data-rule-part="action"]');i&&(i.value=n.condition),a&&(a.value=n.action),i==null||i.addEventListener("change",u=>{r.conditionalRules[t].condition=u.target.value,s()}),a==null||a.addEventListener("change",u=>{r.conditionalRules[t].action=u.target.value,s()}),(c=o.querySelector(".remove-rule"))==null||c.addEventListener("click",()=>{A(t)}),e.appendChild(o)})}}function S(){if(!l)return"";let e=[];return Object.entries(l.properties).forEach(([n,t])=>{t.forEach(o=>{e.push(`<option value="${n}=${o}">${n} = ${o}</option>`)})}),e.join("")}function R(){if(!l)return"";let e=[];return Object.entries(l.properties).forEach(([n,t])=>{t.forEach(o=>{e.push(`<option value="${n}=${o}">${n} = ${o}</option>`)})}),e.push(`<option value="${w}">Reset to initial state</option>`),e.join("")}function A(e){r.conditionalRules.splice(e,1),d(),s()}function E(){let e=document.getElementById("primary-action");!e||!l||(e.innerHTML='<option value="">Select target state...</option>',Object.entries(l.properties).forEach(([n,t])=>{t.forEach(o=>{let i=document.createElement("option");i.value=`${n}=${o}`,i.textContent=`${n} = ${o}`,e.appendChild(i)})}))}function C(e){r=h({},e),E();let n=document.getElementById("primary-action");n&&(n.value=e.primaryAction),d(),s()}function y(){r={component:"",primaryAction:"",conditionalRules:[]};let e=document.getElementById("primary-action");e&&(e.innerHTML='<option value="">Select target state...</option>'),d(),s()}function m(e,n="info"){let t=document.getElementById("status");t&&(t.textContent=e,t.className=`status ${n}`,t.style.display="block",setTimeout(()=>{t.style.display="none"},5e3))}window.onmessage=e=>{let n=e.data.pluginMessage;switch(n.type){case"selection-changed":{f();let t=document.getElementById("loading"),o=document.getElementById("empty-state"),i=document.getElementById("component-list");t&&(t.style.display="block"),o&&(o.style.display="none"),i&&(i.style.display="none");break}case"init-success":M(n.data);break;case"error":{m(n.message,"error"),f();let t=document.getElementById("loading"),o=document.getElementById("empty-state"),i=document.getElementById("component-list");t&&(t.style.display="none"),o&&(o.style.display="block"),i&&(i.style.display="none");break}case"interaction-created":m(n.message,"success"),y();break;default:console.log("Unknown message type:",n.type)}};function M(e){p=e.components,g=e.existingInteractions||{},f();let n=document.getElementById("loading"),t=document.getElementById("empty-state"),o=document.getElementById("component-list");n&&(n.style.display="none"),p.length===0?(t&&(t.style.display="block"),o&&(o.style.display="none")):(t&&(t.style.display="none"),T(),o&&(o.style.display="block"))}function f(){l=null;let e=document.getElementById("rule-builder"),n=document.getElementById("no-selection");e&&e.classList.remove("active"),n&&(n.style.display="block"),y();let t=document.getElementById("status");t&&(t.style.display="none")}function T(){let e=document.getElementById("component-list");e&&(e.innerHTML="",p.forEach(n=>{let t=document.createElement("li");t.className="component-item",t.dataset.componentId=n.id;let o=Object.keys(n.properties).length,i=n.instances.length,a=g[n.id],c=a?" \u{1F39B}\uFE0F":"";t.innerHTML=`
      <div class="component-name">\u{1F9E9} ${n.name}${c}</div>
      <div class="component-info">
        Rules apply to ${i} instance${i!==1?"s":""} \u2022 
        ${o} variant propert${o!==1?"ies":"y"}
        ${a?" \u2022 Has existing interactions":""}
      </div>
    `,e.appendChild(t)}))}function z(e){document.querySelectorAll(".component-item").forEach(a=>{a.classList.remove("selected")});let n=document.querySelector(`[data-component-id="${e}"]`);n&&n.classList.add("selected"),l=p.find(a=>a.id===e),r.component=e;let t=document.getElementById("no-selection"),o=document.getElementById("rule-builder");t&&(t.style.display="none"),o&&o.classList.add("active"),E();let i=g[e];i?C(i):y(),d()}})();
//# sourceMappingURL=ui.js.map
